<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oto Yƒ±kama Takip Sistemi</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        /* Genel Sƒ±fƒ±rlama ve Body Stili */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* Ana Konteyner */
        .container {
            max-width: 1200px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }

        /* Ba≈ülƒ±k Stili */
        .header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        /* Buton Stili */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.4);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }


        /* Ekran Y√∂netimi */
        .screen {
            display: none;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form √ñƒüeleri */
        .form-group {
            margin-bottom: 20px;
            position: relative; /* For error messages */
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: #fcfcfc;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
        }
        input.is-invalid, select.is-invalid, textarea.is-invalid {
            border-color: #e74c3c;
            box-shadow: 0 0 0 4px rgba(231, 76, 60, 0.2);
        }
        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            position: absolute;
            bottom: -18px; /* Position below input */
            left: 0;
        }


        /* Arama √áubuƒüu */
        .search-container {
            position: relative;
            margin-bottom: 30px;
        }

        .search-input {
            padding-left: 50px;
            font-size: 18px;
            height: 60px;
            border-radius: 30px;
            background-color: #f0f0f0;
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            color: #667eea;
        }

        /* Ara√ß Kartƒ± G√∂sterimi */
        .car-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #e0e6f0 100%);
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
        }

        .car-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .car-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .plate-number {
            font-size: 26px;
            font-weight: bold;
            color: #4a5ee5;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.05);
        }

        .status {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Yeni Durum Renkleri */
        .status.inqueue {
            background: #bdbdbd; /* Gri */
            color: #424242;
        }
        .status.exteriorwash {
            background: #ffd54f; /* Hafif sarƒ± */
            color: #f57f17;
        }
        .status.dryingarea {
            background: #a5d6a7; /* Hafif ye≈üil */
            color: #2e7d32;
        }
        .status.parkingarea {
            background: #90caf9; /* Hafif mavi */
            color: #1976d2;
        }
        .status.delivered {
            background: #b0bec5; /* Mavi gri */
            color: #455a64;
        }

        /* A√ßƒ±lƒ±r Kapanƒ±r Detaylar */
        .car-card details {
            margin-top: 15px;
            border-top: 1px solid rgba(0,0,0,0.1);
            padding-top: 15px;
        }

        .car-card summary {
            font-weight: bold;
            cursor: pointer;
            color: #667eea;
            list-style: none;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
        }

        .car-card summary::before {
            content: "\f054"; /* Font Awesome saƒü ok */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            margin-right: 5px;
            transition: transform 0.2s ease;
        }

        .car-card details[open] summary::before {
            transform: rotate(90deg); /* A√ßƒ±kken oku d√∂nd√ºr */
        }

        .car-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
            margin-top: 15px;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.85);
            padding: 12px;
            border-radius: 10px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .detail-label {
            font-size: 13px;
            color: #777;
            margin-bottom: 5px;
        }

        .detail-value {
            font-weight: bold;
            color: #333;
            word-break: break-word;
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 10px;
            margin: 15px 0;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Memnuniyet Anketi */
        .satisfaction-survey {
            background: linear-gradient(135deg, #fff0da 0%, #ffdfc0 100%);
            border-radius: 18px;
            padding: 30px;
            margin-top: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .satisfaction-survey h3 {
            color: #d17a22;
            margin-bottom: 15px;
            font-size: 24px;
        }

        .satisfaction-survey p {
            color: #6a4a2a;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .rating-stars {
            display: flex;
            gap: 12px;
            margin: 15px 0 25px;
            justify-content: center;
        }

        .star {
            font-size: 36px;
            color: #c7c7c7;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
        }

        .star.active, .star:hover {
            color: #ffc107;
            transform: scale(1.1);
        }

        /* Raporlar B√∂l√ºm√º */
        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .report-card {
            background: linear-gradient(135deg, #e6f7f7 0%, #d8eafa 100%);
            border-radius: 18px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .report-number {
            font-size: 42px;
            font-weight: bold;
            color: #4a5ee5;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
        }

        .report-label {
            font-size: 15px;
            color: #666;
        }

        /* Giri≈ü Formu */
        .login-form {
            max-width: 450px;
            margin: 0 auto;
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }

        .welcome-text {
            font-size: 28px;
            margin-bottom: 30px;
            color: #667eea;
            font-weight: bold;
        }

        .user-info {
            background: rgba(102, 126, 234, 0.08);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            text-align: left;
            color: #555;
            font-size: 15px;
            line-height: 1.6;
        }

        .user-info p {
            margin-bottom: 5px;
        }

        .user-info strong {
            color: #667eea;
        }

        /* Hƒ±zlƒ± giri≈ü butonlarƒ± kaldƒ±rƒ±ldƒ± */

        /* Admin Paneli B√∂l√ºmleri */
        .section-header {
            background: rgba(248, 249, 250, 0.9);
            padding: 25px;
            border-radius: 18px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .section-header h3 {
            color: #4a5ee5;
            margin-bottom: 20px;
            font-size: 22px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.1);
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Bildirim Stili */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 18px 25px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            z-index: 1000;
            transform: translateX(calc(100% + 30px));
            transition: transform 0.4s ease-out;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(45deg, #4caf50, #40a045);
        }

        .notification.error {
            background: linear-gradient(45deg, #f44336, #d32f2f);
        }

        /* Admin/√áalƒ±≈üan Aksiyon Butonlarƒ± */
        .button-group {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .status-controls {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .status-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            background-color: #f0f0f0;
            color: #555;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .status-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .status-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
            box-shadow: 0 2px 5px rgba(102, 126, 234, 0.3);
        }

        /* Yeni durum buton renkleri */
        .status-btn.inqueue.active { background: linear-gradient(45deg, #bdbdbd, #9e9e9e); color: white; border-color: #9e9e9e; }
        .status-btn.exteriorwash.active { background: linear-gradient(45deg, #ffd54f, #ffc107); color: #a0522d; border-color: #ffc107; }
        .status-btn.dryingarea.active { background: linear-gradient(45deg, #a5d6a7, #66bb6a); color: #1b5e20; border-color: #66bb6a; }
        .status-btn.parkingarea.active { background: linear-gradient(45deg, #90caf9, #64b5f6); color: #1976d2; border-color: #64b5f6; }
        .status-btn.delivered.active { background: linear-gradient(45deg, #b0bec5, #78909c); color: white; border-color: #78909c; }


        /* Detaylƒ± Ara√ß Listesi (Raporlar) */
        .detailed-car-list .car-card {
            background: #ffffff;
            border: 1px solid #eee;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        /* Responsive Ayarlamalar */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                padding: 15px;
            }

            .nav-buttons {
                justify-content: center;
                width: 100%;
            }

            .nav-buttons .btn {
                flex-grow: 1;
            }

            .container {
                padding: 15px;
            }

            .screen {
                padding: 20px;
            }

            .car-details, .form-grid, .report-grid {
                grid-template-columns: 1fr;
            }

            .plate-number {
                font-size: 22px;
            }

            .search-input {
                font-size: 16px;
                height: 50px;
            }

            .search-icon {
                font-size: 20px;
            }

            .report-number {
                font-size: 36px;
            }

            .notification {
                top: 15px;
                right: 15px;
                left: 15px;
                transform: translateX(calc(100% + 15px));
            }

            .status-controls {
                flex-direction: column;
                align-items: center;
            }
            .status-btn {
                width: 80%;
            }
        }

        @media (max-width: 480px) {
            .btn {
                padding: 10px 15px;
                font-size: 13px;
            }

            .logo {
                font-size: 24px;
            }

            .login-form, .satisfaction-survey, .section-header {
                padding: 20px;
            }
            .welcome-text {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fa-solid fa-car-wash"></i> Oto Yƒ±kama Takip Sistemi
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="showLogin()" id="loginBtn"><i class="fa-solid fa-right-to-bracket"></i> Giri≈ü Yap</button>
                <button class="btn btn-primary" onclick="showCustomerSearch()" id="customerBtn"><i class="fa-solid fa-magnifying-glass"></i> M√º≈üteri Sorgu</button>
                <button class="btn btn-secondary" onclick="showEmployeePanel()" id="employeeBtn" style="display: none;"><i class="fa-solid fa-users-gear"></i> √áalƒ±≈üan Paneli</button>
                <button class="btn btn-secondary" onclick="showAdminPanel()" id="adminBtn" style="display: none;"><i class="fa-solid fa-user-gear"></i> Admin Paneli</button>
                <button class="btn btn-secondary" onclick="showReports()" id="reportsBtn" style="display: none;"><i class="fa-solid fa-chart-line"></i> Raporlar</button>
                <button class="btn btn-danger" onclick="logout()" id="logoutBtn" style="display: none;"><i class="fa-solid fa-right-from-bracket"></i> √áƒ±kƒ±≈ü</button>
            </div>
        </div>

        <!-- Giri≈ü Ekranƒ± -->
        <div id="loginScreen" class="screen">
            <div class="login-form">
                <h2 class="welcome-text">Sisteme Ho≈ü Geldiniz</h2>
                <div class="form-group">
                    <label for="username">Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" id="username" placeholder="Kullanƒ±cƒ± adƒ±nƒ±zƒ± girin" onkeypress="handleEnterKey(event)">
                </div>
                <div class="form-group">
                    <label for="password">≈ûifre</label>
                    <input type="password" id="password" placeholder="≈ûifrenizi girin" onkeypress="handleEnterKey(event)">
                </div>
                <button class="btn btn-primary" onclick="login()"><i class="fa-solid fa-sign-in-alt"></i> Giri≈ü Yap</button>
                <!-- Hƒ±zlƒ± Giri≈ü Butonlarƒ± Kaldƒ±rƒ±ldƒ± -->
                <div class="user-info">
                    <p><strong>Demo Hesaplar:</strong></p>
                    <p><i class="fa-solid fa-key"></i> Admin: <code>admin</code> / <code>668857</code></p>
                    <p><i class="fa-solid fa-user"></i> √áalƒ±≈üan: <code>user1</code> / <code>user123</code></p>
                    <p><i class="fa-solid fa-car"></i> Test Plakalarƒ±: <code>34ABC123</code>, <code>06XYZ789</code></p>
                </div>
            </div>
        </div>

        <!-- M√º≈üteri Sorgu Ekranƒ± -->
        <div id="customerScreen" class="screen">
            <h2><i class="fa-solid fa-search"></i> Ara√ß Durumu Sorgulama</h2>
            <div class="search-container">
                <div class="search-icon">üîç</div>
                <input type="text" class="search-input" id="plateSearch" placeholder="Plaka numarasƒ±nƒ± girin (√∂rn: 34ABC123)" maxlength="8" oninput="searchCar()">
            </div>
            
            <div id="carResults">
                <p style="text-align: center; color: #777;">Plaka numarasƒ±nƒ± girerek ara√ß durumunu sorgulayabilirsiniz.</p>
            </div>
            
            <div class="satisfaction-survey">
                <h3><i class="fa-solid fa-star-half-stroke"></i> Memnuniyet Anketi</h3>
                <p>Hizmetimizden ne kadar memnun kaldƒ±nƒ±z?</p>
                <div class="rating-stars" id="ratingStars">
                    <span class="star" onclick="setRating(1)">‚≠ê</span>
                    <span class="star" onclick="setRating(2)">‚≠ê</span>
                    <span class="star" onclick="setRating(3)">‚≠ê</span>
                    <span class="star" onclick="setRating(4)">‚≠ê</span>
                    <span class="star" onclick="setRating(5)">‚≠ê</span>
                </div>
                <div class="form-group">
                    <textarea id="feedbackText" placeholder="G√∂r√º≈ü ve √∂nerilerinizi payla≈üƒ±n..." rows="3"></textarea>
                </div>
                <button class="btn btn-primary" id="submitFeedbackBtn" onclick="submitFeedback()"><i class="fa-solid fa-paper-plane"></i> Geri Bildirimi G√∂nder</button>
            </div>
        </div>

        <!-- √áalƒ±≈üan Paneli -->
        <div id="employeeScreen" class="screen">
            <h2><i class="fa-solid fa-users-gear"></i> √áalƒ±≈üan Paneli</h2>
            
            <!-- Ara√ß Ekleme/D√ºzenleme -->
            <div class="section-header">
                <h3 id="carFormTitle"><i class="fa-solid fa-car-plus"></i> Yeni Ara√ß Ekle</h3>
                <input type="hidden" id="currentEditingCarId"> <!-- D√ºzenlenen aracƒ±n Firestore ID'si -->
                <div class="form-grid">
                    <div class="form-group">
                        <label for="newPlate">Plaka</label>
                        <input type="text" id="newPlate" placeholder="√∂rn: 34ABC123, ABC1234" maxlength="15" oninput="this.value = this.value.toUpperCase()">
                        <div class="error-message" id="errorNewPlate"></div>
                    </div>
                    <div class="form-group">
                        <label for="customerName">M√º≈üteri Adƒ± (ƒ∞steƒüe Baƒülƒ±)</label>
                        <input type="text" id="customerName" placeholder="M√º≈üteri adƒ±">
                        <div class="error-message" id="errorCustomerName"></div>
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">Telefon (ƒ∞steƒüe Baƒülƒ±)</label>
                        <input type="tel" id="customerPhone" placeholder="√∂rn: 05551234567" maxlength="11">
                        <div class="error-message" id="errorCustomerPhone"></div>
                    </div>
                    <div class="form-group">
                        <label for="carModel">Ara√ß Modeli (ƒ∞steƒüe Baƒülƒ±)</label>
                        <input type="text" id="carModel" placeholder="Marka Model">
                        <div class="error-message" id="errorCarModel"></div>
                    </div>
                    <div class="form-group">
                        <label for="serviceType">Hizmet T√ºr√º</label>
                        <select id="serviceType">
                            <option value="Dƒ±≈ü Yƒ±kama">Dƒ±≈ü Yƒ±kama</option>
                            <option value="ƒ∞√ß Dƒ±≈ü Yƒ±kama">ƒ∞√ß Dƒ±≈ü Yƒ±kama</option>
                            <option value="Detay Yƒ±kama">Detay Yƒ±kama</option>
                            <option value="Cila & Koruma">Cila & Koruma</option>
                        </select>
                        <div class="error-message" id="errorServiceType"></div>
                    </div>
                    <div class="form-group">
                        <label for="carStatus">Ba≈ülangƒ±√ß Durumu</label>
                        <select id="carStatus">
                            <option value="inQueue">Sƒ±rada</option>
                            <option value="exteriorWash">Dƒ±≈ü Yƒ±kamada</option>
                            <option value="dryingArea">Kurulama Alanƒ±nda</option>
                            <option value="parkingArea">Park Alanƒ±nda</option>
                            <option value="delivered">Teslim Edildi</option>
                        </select>
                        <div class="error-message" id="errorCarStatus"></div>
                    </div>
                    <div class="form-group">
                        <label for="estimatedTime">Tahmini S√ºre (dk) (ƒ∞steƒüe Baƒülƒ±)</label>
                        <input type="number" id="estimatedTime" placeholder="√∂rn: 45" min="1">
                        <div class="error-message" id="errorEstimatedTime"></div>
                    </div>
                    <div class="form-group">
                        <label for="carPrice">Fiyat (‚Ç∫) (ƒ∞steƒüe Baƒülƒ±)</label>
                        <input type="number" id="carPrice" placeholder="√∂rn: 150" min="0">
                        <div class="error-message" id="errorCarPrice"></div>
                    </div>
                </div>
                <button class="btn btn-primary" id="submitCarBtn" onclick="handleAddOrUpdateCar()"><i class="fa-solid fa-car-rear"></i> Ara√ß Ekle</button>
                <button class="btn btn-secondary" id="cancelCarEditBtn" style="display: none;" onclick="cancelCarEdit()"><i class="fa-solid fa-times"></i> Vazge√ß</button>
            </div>

            <!-- Mevcut Ara√ßlar -->
            <h3><i class="fa-solid fa-list-check"></i> Mevcut Ara√ßlar</h3>
            <div id="employeeCarList">
                <p style="text-align: center; color: #777;">Y√ºkleniyor...</p>
            </div>
        </div>

        <!-- Admin Paneli -->
        <div id="adminScreen" class="screen">
            <h2><i class="fa-solid fa-user-gear"></i> Admin Paneli</h2>
            
            <!-- Kullanƒ±cƒ± Ekleme -->
            <div class="section-header">
                <h3><i class="fa-solid fa-user-plus"></i> Yeni Kullanƒ±cƒ± Ekle</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="newUsername">Kullanƒ±cƒ± Adƒ±</label>
                        <input type="text" id="newUsername" placeholder="Kullanƒ±cƒ± adƒ±">
                        <div class="error-message" id="errorNewUsername"></div>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">≈ûifre</label>
                        <input type="password" id="newPassword" placeholder="≈ûifre">
                        <div class="error-message" id="errorNewPassword"></div>
                    </div>
                    <div class="form-group">
                        <label for="newUserRole">Rol</label>
                        <select id="newUserRole">
                            <option value="user">√áalƒ±≈üan</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" id="addUserBtn" onclick="addUser()"><i class="fa-solid fa-plus-circle"></i> Kullanƒ±cƒ± Ekle</button>
            </div>

            <!-- Kullanƒ±cƒ± ≈ûifrelerini Y√∂net -->
            <div class="section-header">
                <h3><i class="fa-solid fa-user-lock"></i> Kullanƒ±cƒ± ≈ûifrelerini Y√∂net</h3>
                <p style="font-size: 14px; color: #666; margin-bottom: 15px;">
                    Bu demo uygulamasƒ±nda, kullanƒ±cƒ± ≈üifreleri sadece yerel demo hesabƒ± i√ßin g√ºncellenir. Ger√ßek Firebase Auth projenizde,
                    ba≈üka bir kullanƒ±cƒ±nƒ±n ≈üifresini y√∂netmek i√ßin <a href="https://firebase.google.com/docs/auth/admin/manage-users#update_a_user" target="_blank" style="color: #667eea; text-decoration: underline;">Firebase Admin SDK</a> kullanmanƒ±z gerekir (arka u√ß sunucunuzda).
                </p>
                <div class="form-group">
                    <label for="selectUserForPasswordReset">≈ûifresi Deƒüi≈üecek Kullanƒ±cƒ±</label>
                    <select id="selectUserForPasswordReset">
                        <option value="">Kullanƒ±cƒ± Se√ßin</option>
                        <!-- Kullanƒ±cƒ±lar JS ile doldurulacak -->
                    </select>
                    <div class="error-message" id="errorSelectUserForPasswordReset"></div>
                </div>
                <div class="form-group">
                    <label for="selectedUserNewPassword">Yeni ≈ûifre</label>
                    <input type="password" id="selectedUserNewPassword" placeholder="Yeni ≈üifreyi girin">
                    <div class="error-message" id="errorSelectedUserNewPassword"></div>
                </div>
                <div class="form-group">
                    <label for="confirmSelectedUserNewPassword">Yeni ≈ûifre Tekrar</label>
                    <input type="password" id="confirmSelectedUserNewPassword" placeholder="Yeni ≈üifreyi tekrar girin">
                    <div class="error-message" id="errorConfirmSelectedUserNewPassword"></div>
                </div>
                <button class="btn btn-primary" id="resetSelectedUserPasswordBtn" onclick="resetSelectedUserPassword()"><i class="fa-solid fa-unlock"></i> ≈ûifreyi Sƒ±fƒ±rla</button>
            </div>
            
            <!-- ≈ûifremi Deƒüi≈ütir (Giri≈ü Yapmƒ±≈ü Kullanƒ±cƒ±nƒ±n Kendi ≈ûifresi) -->
            <div class="section-header">
                <h3><i class="fa-solid fa-key"></i> ≈ûifremi Deƒüi≈ütir (Kendi Hesabƒ±nƒ±z)</h3>
                <p style="font-size: 14px; color: #666; margin-bottom: 15px;">
                    Bu demo uygulamasƒ±nda, ≈üifreler sadece yerel demo hesabƒ± i√ßin g√ºncellenir. Ger√ßek Firebase Auth projenizde,
                    kendi ≈üifrenizi deƒüi≈ütirmek i√ßin <a href="https://firebase.google.com/docs/auth/web/manage-users#update_a_users_password" target="_blank" style="color: #667eea; text-decoration: underline;">Firebase Auth belgelerine</a> ba≈üvurun.
                </p>
                <div class="form-group">
                    <label for="oldPassword">Eski ≈ûifre</label>
                    <input type="password" id="oldPassword" placeholder="Eski ≈üifrenizi girin">
                    <div class="error-message" id="errorOldPassword"></div>
                </div>
                <div class="form-group">
                    <label for="newAuthPassword">Yeni ≈ûifre</label>
                    <input type="password" id="newAuthPassword" placeholder="Yeni ≈üifrenizi girin">
                    <div class="error-message" id="errorNewAuthPassword"></div>
                </div>
                <div class="form-group">
                    <label for="confirmNewAuthPassword">Yeni ≈ûifre Tekrar</label>
                    <input type="password" id="confirmNewAuthPassword" placeholder="Yeni ≈üifrenizi tekrar girin">
                    <div class="error-message" id="errorConfirmNewAuthPassword"></div>
                </div>
                <button class="btn btn-primary" id="changeMyOwnPasswordBtn" onclick="changeMyOwnPassword()"><i class="fa-solid fa-lock"></i> ≈ûifremi Deƒüi≈ütir</button>
            </div>

            <!-- Mevcut Kullanƒ±cƒ±lar (Demo Ama√ßlƒ± Listeleme) -->
            <h3><i class="fa-solid fa-users"></i> Mevcut Kullanƒ±cƒ±lar (Demo Listesi)</h3>
            <div id="userList" class="section-header" style="background:none; box-shadow:none;">
                <p style="text-align: center; color: #777;">Y√ºkleniyor...</p>
            </div>
        </div>

        <!-- Raporlar -->
        <div id="reportsScreen" class="screen">
            <h2><i class="fa-solid fa-chart-simple"></i> G√ºnl√ºk Raporlar</h2>
            
            <div class="report-grid">
                <div class="report-card">
                    <div class="report-number" id="totalCars">0</div>
                    <div class="report-label">Toplam Ara√ß</div>
                </div>
                <div class="report-card">
                    <div class="report-number" id="washingCars">0</div>
                    <div class="report-label">Dƒ±≈ü Yƒ±kamada</div>
                </div>
                <div class="report-card">
                    <div class="report-number" id="readyCars">0</div>
                    <div class="report-label">Kurulama Alanƒ±nda</div>
                </div>
                <div class="report-card">
                    <div class="report-number" id="deliveredCars">0</div>
                    <div class="report-label">Teslim Edildi</div>
                </div>
                <div class="report-card">
                    <div class="report-number" id="avgRating">0.0</div>
                    <div class="report-label">Ortalama Puan</div>
                </div>
                <div class="report-card">
                    <div class="report-number" id="totalRevenue">‚Ç∫0</div>
                    <div class="report-label">Toplam Gelir</div>
                </div>
            </div>

            <div class="section-header detailed-car-list">
                <h3><i class="fa-solid fa-table-list"></i> Detaylƒ± Ara√ß Listesi</h3>
                <div id="detailedCarList">
                    <p style="text-align: center; color: #777;">Y√ºkleniyor...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bildirim -->
    <div id="notification" class="notification"></div>

    <script type="module">
        // Firebase Mod√ºllerinin Importlarƒ±
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, updatePassword } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, onSnapshot, orderBy, where, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
        
        // --- Firebase Yapƒ±landƒ±rmasƒ± (Kullanƒ±cƒ± Tarafƒ±ndan Saƒülandƒ±) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBPQ3N_488wEu2lR3Ak63_Fp0FRo87nfSI",
            authDomain: "drawguess-dd2ae.firebaseapp.com",
            projectId: "drawguess-dd2ae",
            storageBucket: "drawguess-dd2ae.firebasestorage.app",
            messagingSenderId: "791576960769",
            appId: "1:791576960769:web:fd1e6597ca5dae73e38500",
            measurementId: "G-VW08E2BNL9"
        };
        // Firestore koleksiyon yollarƒ± i√ßin kullanƒ±lacak uygulama kimliƒüi (proje kimliƒüi)
        const APP_ID_FOR_FIRESTORE_PATHS = firebaseConfig.projectId;


        // --- Global Deƒüi≈ükenler ---
        // Bu deƒüi≈ükenler window objesine atanarak HTML event handler'larƒ±ndan eri≈üilebilir hale getirilir.
        window.currentUser = null;
        window.selectedRating = 0;
        window.cars = []; // Firestore'dan √ßekilecek dinamik veriler
        window.feedback = []; // Firestore'dan √ßekilecek dinamik veriler

        // Demo kullanƒ±cƒ±larƒ± (Firebase Auth entegre edilmediƒüi i√ßin yerel olarak tutulur)
        window.users = [
            { username: "admin", password: "668857", role: "admin" }, // Admin ≈üifresi g√ºncellendi
            { username: "user1", password: "user123", role: "user" }
        ];

        // Firebase instance'larƒ± (window objesine atanƒ±r)
        window.firebaseApp = null;
        window.firestoreDb = null;
        window.firebaseAuth = null;
        window.currentUserId = null;
        window.isFirebaseReady = false;

        // Firestore koleksiyon referanslarƒ± (window objesine atanƒ±r)
        window.carsCollectionRef = null;
        window.feedbackCollectionRef = null;
        window.historicalCarsCollectionRef = null; // Ar≈üivlenmi≈ü ara√ßlar
        window.historicalFeedbackCollectionRef = null; // Ar≈üivlenmi≈ü geri bildirimler
        window.settingsDocRef = null; // G√ºnl√ºk temizlik ayarlarƒ± i√ßin

        // Firestore Dinleyicileri i√ßin unsubscribe fonksiyonlarƒ±
        let carsUnsubscribe = null;
        let feedbackUnsubscribe = null;

        // --- Firebase Ba≈ülatma ve Y√∂netim Fonksiyonlarƒ± ---

        /**
         * Firebase'i ba≈ülatƒ±r ve kimlik doƒürulama durumunu y√∂netir.
         * window.onload tarafƒ±ndan √ßaƒürƒ±lƒ±r.
         */
        async function initializeFirebaseAndAuth() {
            console.log("Firebase ba≈ülatƒ±lƒ±yor...");
            try {
                // Firebase uygulamalarƒ±nƒ± ve servislerini ba≈ülat
                window.firebaseApp = initializeApp(firebaseConfig);
                window.firestoreDb = getFirestore(window.firebaseApp);
                window.firebaseAuth = getAuth(window.firebaseApp);

                // Koleksiyon referanslarƒ±nƒ± tanƒ±mla
                window.carsCollectionRef = collection(window.firestoreDb, 'artifacts', APP_ID_FOR_FIRESTORE_PATHS, 'public', 'data', 'cars');
                window.feedbackCollectionRef = collection(window.firestoreDb, 'artifacts', APP_ID_FOR_FIRESTORE_PATHS, 'public', 'data', 'feedback');
                window.historicalCarsCollectionRef = collection(window.firestoreDb, 'artifacts', APP_ID_FOR_FIRESTORE_PATHS, 'public', 'data', 'historical_cars');
                window.historicalFeedbackCollectionRef = collection(window.firestoreDb, 'artifacts', APP_ID_FOR_FIRESTORE_PATHS, 'public', 'data', 'historical_feedback');
                window.settingsDocRef = doc(window.firestoreDb, 'artifacts', APP_ID_FOR_FIRESTORE_PATHS, 'public', 'data', 'settings', 'daily_cleanup');
                
                console.log("Firebase servisleri ba≈ülatƒ±ldƒ±. Project ID:", APP_ID_FOR_FIRESTORE_PATHS);

                // Kimlik doƒürulama durumu deƒüi≈ütiƒüinde tetiklenir
                onAuthStateChanged(window.firebaseAuth, async (user) => {
                    if (user) {
                        window.currentUserId = user.uid;
                        console.log("Firebase Auth Durumu Deƒüi≈üti: Giri≈ü yapƒ±ldƒ±:", user.uid);
                    } else {
                        // Anonim veya √ßƒ±kƒ±≈ü yapƒ±lmƒ±≈üsa rastgele bir ID kullan
                        window.currentUserId = crypto.randomUUID();
                        console.log("Firebase Auth Durumu Deƒüi≈üti: √áƒ±kƒ±≈ü yapƒ±ldƒ± / Anonim. Rastgele ID kullanƒ±lƒ±yor:", window.currentUserId);
                    }
                    window.isFirebaseReady = true;
                    console.log("Firebase hazƒ±r bayraƒüƒ± ayarlandƒ±. appReadySetup √ßaƒürƒ±lƒ±yor.");
                    await appReadySetup();
                });

                // Ba≈ülangƒ±√ß kimlik doƒürulamasƒ±nƒ± yap
                // __initial_auth_token burada doƒürudan Canvas ortamƒ± tarafƒ±ndan saƒülanmadƒ±ƒüƒ± i√ßin anonim giri≈ü varsayƒ±lƒ±r.
                // Eƒüer √∂zel bir token kullanmanƒ±z gerekirse, bu satƒ±rƒ± uygun ≈üekilde deƒüi≈ütirmeniz gerekir.
                console.log("Anonim giri≈ü deniyor...");
                await signInAnonymously(window.firebaseAuth);
                console.log("Anonim olarak giri≈ü yapƒ±ldƒ±.");

            } catch (e) {
                console.error("Firebase ba≈ülatma veya kimlik doƒürulama ba≈üarƒ±sƒ±z oldu:", e);
                showNotification("Firebase ba≈ülatƒ±lƒ±rken veya baƒülanƒ±rken hata olu≈ütu!", "error");
            }
        }

        /**
         * Firebase baƒülantƒ±sƒ± kurulduktan sonra Firestore dinleyicilerini ayarlar.
         * window.cars ve window.feedback'i ger√ßek zamanlƒ± olarak g√ºnceller.
         */
        function setupFirestoreListeners() {
            if (!window.firestoreDb) {
                console.error("Firestore DB ba≈ülatƒ±lmadƒ±. Dinleyiciler ayarlanamƒ±yor.");
                return;
            }
            // Mevcut dinleyicileri kapat (√∂nceki dinlemelerin √ßift tetiklenmesini √∂nlemek i√ßin)
            if (carsUnsubscribe) carsUnsubscribe();
            if (feedbackUnsubscribe) feedbackUnsubscribe();

            console.log("Firestore dinleyicileri ayarlanƒ±yor...");

            // Arabalar koleksiyonu i√ßin dinleyici
            carsUnsubscribe = onSnapshot(query(window.carsCollectionRef), (snapshot) => {
                window.cars = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Firestore'dan ara√ßlar g√ºncellendi. Ara√ß sayƒ±sƒ±:", window.cars.length);
                // ƒ∞lgili UI'larƒ± yeniden render et
                if (document.getElementById('employeeScreen').classList.contains('active')) {
                    renderEmployeeCarList();
                }
                if (document.getElementById('reportsScreen').classList.contains('active')) {
                    renderReports();
                }
                const plateSearchInput = document.getElementById('plateSearch');
                if (document.getElementById('customerScreen').classList.contains('active') && plateSearchInput.value.trim().length > 1) {
                    searchCar();
                }
            }, (error) => {
                console.error("Cars collection snapshot error:", error);
                showNotification("Ara√ß verileri y√ºklenirken hata olu≈ütu!", "error");
            });

            // Geri bildirimler koleksiyonu i√ßin dinleyici
            feedbackUnsubscribe = onSnapshot(query(window.feedbackCollectionRef), (snapshot) => {
                window.feedback = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Firestore'dan geri bildirimler g√ºncellendi. Geri bildirim sayƒ±sƒ±:", window.feedback.length);
                if (document.getElementById('reportsScreen').classList.contains('active')) {
                    renderReports();
                }
            }, (error) => {
                console.error("Feedback collection snapshot error:", error);
                showNotification("Geri bildirim verileri y√ºklenirken hata olu≈ütu!", "error");
            });
        }

        /**
         * Firebase hazƒ±r olduƒüunda √ßalƒ±≈üacak ana kurulum fonksiyonu.
         */
        async function appReadySetup() {
            if (!window.isFirebaseReady) {
                console.warn("appReadySetup √ßaƒürƒ±ldƒ± ama Firebase hen√ºz hazƒ±r deƒüil.");
                return;
            }
            console.log("appReadySetup ba≈ülatƒ±lƒ±yor...");

            setupFirestoreListeners(); // Firestore dinleyicilerini ba≈ülat
            await performDailyCleanup(); // G√ºnl√ºk temizliƒüi √ßalƒ±≈ütƒ±r ve ar≈üivle

            // localStorage'dan kullanƒ±cƒ± oturumunu geri y√ºklemeyi dene
            const storedUser = localStorage.getItem('currentUser');
            if (storedUser) {
                window.currentUser = JSON.parse(storedUser);
                console.log("Kullanƒ±cƒ± localStorage'dan geri y√ºklendi:", window.currentUser.username);
            } else {
                console.log("localStorage'da kullanƒ±cƒ± bulunamadƒ±.");
            }
            updateUI();
            // Giri≈ü yapmƒ±≈ü kullanƒ±cƒ±larƒ± ilgili panellerine y√∂nlendir, aksi takdirde m√º≈üteri sorgu ekranƒ±nƒ± g√∂ster
            if (window.currentUser && window.currentUser.role === 'admin') {
                showAdminPanel(); 
            } else if (window.currentUser && window.currentUser.role === 'user') {
                showEmployeePanel();
            } else {
                showCustomerSearch(); // Uygulama a√ßƒ±ldƒ±ƒüƒ±nda varsayƒ±lan ekran: M√º≈üteri Sorgu
            }
        }
        
        // --- Genel Yardƒ±mcƒ± Fonksiyonlar ---

        /**
         * T√ºm ekranlarƒ± gizler ve belirtilen ekranƒ± g√∂sterir.
         * @param {string} screenId - G√∂sterilecek ekranƒ±n ID'si.
         */
        window.showScreen = function(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        };

        /**
         * Navigasyon butonlarƒ±nƒ±n g√∂r√ºn√ºrl√ºƒü√ºn√º mevcut kullanƒ±cƒ±nƒ±n kimlik doƒürulama durumu ve rol√ºne g√∂re g√ºnceller.
         */
        window.updateUI = function() {
            const loginBtn = document.getElementById('loginBtn');
            const customerBtn = document.getElementById('customerBtn');
            const employeeBtn = document.getElementById('employeeBtn');
            const adminBtn = document.getElementById('adminBtn');
            const reportsBtn = document.getElementById('reportsBtn');
            const logoutBtn = document.getElementById('logoutBtn');

            // M√º≈üteri sorgu butonu her zaman g√∂r√ºn√ºr
            customerBtn.style.display = 'block';

            if (window.currentUser) {
                // Giri≈ü yapƒ±lmƒ±≈üsa
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'block';
                
                if (window.currentUser.role === 'user') { // √áalƒ±≈üan rol√º
                    employeeBtn.style.display = 'block';
                    adminBtn.style.display = 'none';
                    reportsBtn.style.display = 'none';
                } else if (window.currentUser.role === 'admin') { // Admin rol√º
                    employeeBtn.style.display = 'block'; // Adminler de √ßalƒ±≈üan panelini kullanabilir
                    adminBtn.style.display = 'block';
                    reportsBtn.style.display = 'block';
                }
            } else {
                // Giri≈ü yapƒ±lmamƒ±≈üsa
                loginBtn.style.display = 'block';
                logoutBtn.style.display = 'none';
                employeeBtn.style.display = 'none';
                adminBtn.style.display = 'none';
                reportsBtn.style.display = 'none';
            }
        };

        /**
         * Ekranƒ±n saƒü √ºst√ºnde bir bildirim mesajƒ± g√∂sterir.
         * @param {string} message - G√∂sterilecek mesaj.
         * @param {'success'|'error'|'info'} type - Bildirim t√ºr√º (rengi belirler).
         */
        window.showNotification = function(message, type) {
            const notification = document.getElementById('notification');
            if (!notification) {
                console.error("Bildirim elementi bulunamadƒ±!");
                return;
            }
            notification.textContent = message;
            notification.className = `notification ${type}`; // Sƒ±nƒ±flarƒ± sƒ±fƒ±rla ve t√ºr√º ekle
            // T√ºre g√∂re ikon ekle
            if (type === 'success') {
                notification.innerHTML = '<i class="fa-solid fa-check-circle"></i> ' + message;
            } else if (type === 'error') {
                notification.innerHTML = '<i class="fa-solid fa-times-circle"></i> ' + message;
            } else if (type === 'info') {
                notification.innerHTML = '<i class="fa-solid fa-info-circle"></i> ' + message;
            }
            
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000); // 3 saniye sonra bildirim kaybolur
        };

        /**
         * Belirtilen bir butonu asenkron bir i≈ülem sƒ±rasƒ±nda devre dƒ±≈üƒ± bƒ±rakƒ±r/etkinle≈ütirir.
         * @param {string} buttonId - Butonun ID'si.
         * @param {boolean} disabled - Devre dƒ±≈üƒ± bƒ±rakmak i√ßin true, etkinle≈ütirmek i√ßin false.
         */
        function toggleButtonState(buttonId, disabled) {
            const button = document.getElementById(buttonId);
            if (button) {
                button.disabled = disabled;
            }
        }

        /**
         * Form alanlarƒ±nƒ± doƒürular ve hata mesajlarƒ±nƒ± g√∂sterir.
         * @param {Array<Object>} fields - Doƒürulanacak alanlarƒ±n listesi.
         * @returns {boolean} T√ºm alanlar ge√ßerliyse true, aksi takdirde false.
         */
        function validateForm(fields) {
            let isValid = true;
            fields.forEach(field => {
                const inputElement = document.getElementById(field.id);
                const errorElement = document.getElementById(`error${capitalizeFirstLetter(field.id)}`);
                if (!inputElement) {
                    console.warn(`Input elementi bulunamadƒ±: ${field.id}`);
                    return;
                }
                
                inputElement.classList.remove('is-invalid');
                if (errorElement) errorElement.textContent = ''; // Hata mesajƒ±nƒ± temizle

                let errorMessage = '';
                const inputValue = inputElement.value.trim();

                if (field.required && !inputValue) {
                    errorMessage = field.name + ' alanƒ± bo≈ü bƒ±rakƒ±lamaz.';
                } else if (inputValue) { // Eƒüer deƒüer girilmi≈üse √∂zel validasyonlarƒ± uygula
                    if (field.type === 'phone' && !/^\d{10,11}$/.test(inputValue)) {
                        errorMessage = 'Telefon numarasƒ± 10 veya 11 hane olmalƒ± ve sadece rakamlardan olu≈ümalƒ±dƒ±r.';
                    } else if (field.type === 'number' && (isNaN(parseFloat(inputValue)) || parseFloat(inputValue) < (field.min || 0))) {
                        errorMessage = field.name + ' pozitif bir sayƒ± olmalƒ±dƒ±r.';
                    } else if (field.type === 'password' && inputValue.length < 6) {
                        errorMessage = field.name + ' en az 6 karakter olmalƒ±dƒ±r.';
                    } else if (field.type === 'confirmPassword') {
                        const passwordInput = document.getElementById(field.matchId);
                        if (inputValue !== passwordInput.value) {
                            errorMessage = '≈ûifreler e≈üle≈ümiyor.';
                        }
                    }
                }

                if (errorMessage) {
                    inputElement.classList.add('is-invalid');
                    if (errorElement) errorElement.textContent = errorMessage;
                    isValid = false;
                }
            });
            return isValid;
        }

        /**
         * Giri≈ü alanlarƒ±nda Enter tu≈üuna basƒ±ldƒ±ƒüƒ±nda giri≈üi tetikler.
         * @param {KeyboardEvent} event - Klavye olayƒ±.
         */
        window.handleEnterKey = function(event) {
            if (event.key === 'Enter') {
                window.login();
            }
        };

        /**
         * Saƒülanan kimlik bilgileriyle bir kullanƒ±cƒ± giri≈üi yapmaya √ßalƒ±≈üƒ±r.
         */
        window.login = function() {
            console.log("login() √ßaƒürƒ±ldƒ±.");
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            
            // √ñnceki doƒürulama stillerini/mesajlarƒ±nƒ± temizle
            usernameInput.classList.remove('is-invalid');
            passwordInput.classList.remove('is-invalid');
            
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            
            let isValid = true;
            if (!username) {
                usernameInput.classList.add('is-invalid');
                isValid = false;
            }
            if (!password) {
                passwordInput.classList.add('is-invalid');
                isValid = false;
            }
            if (!isValid) {
                showNotification('Kullanƒ±cƒ± adƒ± ve ≈üifre giriniz!', 'error');
                return;
            }

            console.log(`Giri≈ü denemesi: Kullanƒ±cƒ± Adƒ±: ${username}, ≈ûifre: ${password ? '*****' : ''}`);
            const user = window.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                window.currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user)); // Giri≈ü durumunu kalƒ±cƒ± yap
                updateUI();
                showNotification(`Ho≈ü geldiniz ${user.username}!`, 'success');
                // Role g√∂re y√∂nlendirme
                if (user.role === 'admin') {
                    showAdminPanel(); 
                } else if (user.role === 'user') { // √áalƒ±≈üan
                    showEmployeePanel();
                }
                usernameInput.value = ''; // Alanlarƒ± temizle
                passwordInput.value = '';
                console.log("Giri≈ü ba≈üarƒ±lƒ±. Kullanƒ±cƒ±:", user.username, "Y√∂nlendiriliyor...");
            } else {
                showNotification('Kullanƒ±cƒ± adƒ± veya ≈üifre hatalƒ±!', 'error');
                usernameInput.classList.add('is-invalid');
                passwordInput.classList.add('is-invalid');
                console.log("Giri≈ü ba≈üarƒ±sƒ±z: Yanlƒ±≈ü kullanƒ±cƒ± adƒ± veya ≈üifre.");
            }
        };

        /**
         * Mevcut kullanƒ±cƒ±yƒ± √ßƒ±kƒ±≈ü yapar.
         */
        window.logout = function() {
            window.currentUser = null;
            localStorage.removeItem('currentUser'); // Kalƒ±cƒ± durumu temizle
            updateUI();
            showLogin(); // Giri≈ü ekranƒ±na d√∂n
            showNotification('Ba≈üarƒ±yla √ßƒ±kƒ±≈ü yapƒ±ldƒ±!', 'success');
        };

        /**
         * Hƒ±zlƒ± giri≈ü butonlarƒ± kaldƒ±rƒ±ldƒ±. Bu fonksiyon artƒ±k kullanƒ±lmƒ±yor.
         */
        // window.quickLogin = function(roleType) { ... };

        /**
         * Giri≈ü ekranƒ±nƒ± g√∂sterir.
         */
        window.showLogin = function() {
            showScreen('loginScreen');
        };

        /**
         * M√º≈üteri sorgu ekranƒ±nƒ± g√∂sterir ve ba≈ülatƒ±r.
         */
        window.showCustomerSearch = function() {
            showScreen('customerScreen');
            document.getElementById('plateSearch').value = ''; // Arama alanƒ±nƒ± temizle
            document.getElementById('carResults').innerHTML = '<p style="text-align: center; color: #777;">Plaka numarasƒ±nƒ± girerek ara√ß durumunu sorgulayabilirsiniz.</p>';
            window.selectedRating = 0; // Anketi sƒ±fƒ±rla
            document.getElementById('feedbackText').value = '';
            document.querySelectorAll('#ratingStars .star').forEach(star => star.classList.remove('active'));
            updateUI(); // Bu ekrana ge√ßi≈üte butonlarƒ±n doƒüru olduƒüundan emin ol
        };

        /**
         * √áalƒ±≈üan panelini g√∂sterir ve mevcut ara√ß listesini render eder.
         */
        window.showEmployeePanel = function() {
            if (!window.currentUser || (window.currentUser.role !== 'user' && window.currentUser.role !== 'admin')) {
                showNotification('Bu alana eri≈üim izniniz yok!', 'error');
                showLogin(); // Yetkisizse giri≈ü ekranƒ±na y√∂nlendir
                return;
            }
            showScreen('employeeScreen');
            cancelCarEdit(); // Formu her zaman temiz bir ≈üekilde g√∂ster
            updateUI(); // Bu ekrana ge√ßi≈üte butonlarƒ±n doƒüru olduƒüundan emin ol
            // Data will be rendered via Firestore listener in setupFirestoreListeners
        };

        /**
         * Admin panelini (kullanƒ±cƒ± y√∂netimi) g√∂sterir ve mevcut kullanƒ±cƒ± listesini render eder.
         */
        window.showAdminPanel = function() {
            if (!window.currentUser || window.currentUser.role !== 'admin') {
                showNotification('Bu alana eri≈üim izniniz yok!', 'error');
                showLogin(); // Yetkisizse giri≈ü ekranƒ±na y√∂nlendir
                return;
            }
            showScreen('adminScreen');
            renderUserList(); // Admin paneline kullanƒ±cƒ±larƒ± render et
            populateUserSelectionForPasswordReset(); // Kullanƒ±cƒ± se√ßme dropdown'ƒ±nƒ± doldur
            
            // Yeni kullanƒ±cƒ± formunu temizle
            document.getElementById('newUsername').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('newUserRole').value = 'user';
            
            // Kendi ≈üifre deƒüi≈ütirme formunu temizle
            document.getElementById('oldPassword').value = '';
            document.getElementById('newAuthPassword').value = '';
            document.getElementById('confirmNewAuthPassword').value = '';
            
            // Kullanƒ±cƒ± ≈üifre sƒ±fƒ±rlama formunu temizle
            document.getElementById('selectUserForPasswordReset').value = '';
            document.getElementById('selectedUserNewPassword').value = '';
            document.getElementById('confirmSelectedUserNewPassword').value = '';

            // T√ºm hata mesajlarƒ±nƒ± ve invalid stillerini temizle
            document.querySelectorAll('#adminScreen .error-message').forEach(el => el.textContent = '');
            document.querySelectorAll('#adminScreen input, #adminScreen select').forEach(el => el.classList.remove('is-invalid'));

            updateUI(); // Bu ekrana ge√ßi≈üte butonlarƒ±n doƒüru olduƒüundan emin ol
        };

        /**
         * Raporlar ekranƒ±nƒ± g√∂sterir ve raporlarƒ± olu≈üturur.
         */
        window.showReports = function() {
            if (!window.currentUser || window.currentUser.role !== 'admin') {
                showNotification('Bu alana eri≈üim izniniz yok!', 'error');
                showLogin(); // Yetkisizse giri≈ü ekranƒ±na y√∂nlendir
                return;
            }
            showScreen('reportsScreen');
            renderReports(); // Raporlarƒ± olu≈ütur ve g√∂ster
            updateUI(); // Bu ekrana ge√ßi≈üte butonlarƒ±n doƒüru olduƒüundan emin ol
        };

        /**
         * Ara√ß kartlarƒ±nƒ± belirtilen HTML √∂ƒüesine render eder.
         * @param {string} targetElementId - Ara√ßlarƒ±n render edileceƒüi √∂ƒüenin ID'si.
         * @param {Array<Object>} carsToRender - G√∂r√ºnt√ºlenecek ara√ß nesneleri dizisi.
         * @param {boolean} allowCarActions - √áalƒ±≈üan/admin paneli i√ßin render ediliyorsa true (aksiyon butonlarƒ± ekler).
         * @param {boolean} showDrawer - Detaylar geni≈ületilebilir bir √ßekmecede g√∂sterilmeli mi.
         */
        function renderCars(targetElementId, carsToRender, allowCarActions = false, showDrawer = false) {
            const container = document.getElementById(targetElementId);
            if (!container) {
                console.error(`Hedef √∂ƒüe "${targetElementId}" bulunamadƒ±.`);
                return;
            }
            container.innerHTML = ''; // √ñnceki sonu√ßlarƒ± temizle

            if (carsToRender.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #777;">Hi√ß ara√ß bulunamadƒ±.</p>';
                return;
            }

            // `car.entryTime` tarihine g√∂re en yeniden en eskiye sƒ±rala
            const sortedCars = [...carsToRender].sort((a, b) => new Date(b.entryTime) - new Date(a.entryTime));

            sortedCars.forEach(car => {
                const entryDate = formatDate(car.entryTime);
                const entryTime = formatTime(car.entryTime);
                const progressWidth = car.currentProgress > 0 ? car.currentProgress : 0;

                // Silme butonu sadece admin i√ßin g√∂sterilsin
                const showDeleteButton = window.currentUser && window.currentUser.role === 'admin';
                const showEditButton = window.currentUser && (window.currentUser.role === 'admin' || window.currentUser.role === 'user');

                // Durumun T√ºrk√ße metni ve CSS sƒ±nƒ±fƒ± e≈üle≈ütirmesi
                const statusMap = {
                    'inQueue': { text: 'Sƒ±rada', class: 'inqueue' },
                    'exteriorWash': { text: 'Dƒ±≈ü Yƒ±kamada', class: 'exteriorwash' },
                    'dryingArea': { text: 'Kurulama Alanƒ±nda', class: 'dryingarea' },
                    'parkingArea': { text: 'Park Alanƒ±nda', class: 'parkingarea' },
                    'delivered': { text: 'Teslim Edildi', class: 'delivered' }
                };
                const currentStatusInfo = statusMap[car.status] || { text: capitalizeFirstLetter(car.status), class: car.status };


                const carDetailsHtml = `
                    <div class="car-details">
                        <div class="detail-item">
                            <div class="detail-label">M√º≈üteri Adƒ±</div>
                            <div class="detail-value">${car.customer || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Telefon</div>
                            <div class="detail-value">${car.phone || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Ara√ß Modeli</div>
                            <div class="detail-value">${car.model || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Hizmet T√ºr√º</div>
                            <div class="detail-value">${car.serviceType || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Giri≈ü Zamanƒ±</div>
                            <div class="detail-value">${entryDate} ${entryTime}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Tahmini S√ºre</div>
                            <div class="detail-value">${car.estimatedTime ? car.estimatedTime + ' dk' : 'N/A'}</div>
                        </div>
                         <div class="detail-item">
                            <div class="detail-label">Fiyat</div>
                            <div class="detail-value">‚Ç∫${car.price ? car.price.toLocaleString('tr-TR') : 'N/A'}</div>
                        </div>
                         <div class="detail-item">
                            <div class="detail-label">Ekleyen</div>
                            <div class="detail-value">${car.addedBy || 'N/A'}</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressWidth}%;"></div>
                    </div>
                `;

                const carCardHtml = `
                    <div class="car-card">
                        <div class="car-header">
                            <div class="plate-number">${car.plate.toUpperCase()}</div>
                            <div class="status ${currentStatusInfo.class}">${currentStatusInfo.text}</div>
                        </div>
                        ${showDrawer ? `
                        <details>
                            <summary>Detaylarƒ± G√∂r <i class="fa-solid fa-angle-right"></i></summary>
                            ${carDetailsHtml}
                        </details>
                        ` : carDetailsHtml}

                        ${allowCarActions && (window.currentUser && (window.currentUser.role === 'admin' || window.currentUser.role === 'user')) ? `
                        <div class="status-controls">
                            <button class="status-btn inqueue ${car.status === 'inQueue' ? 'active' : ''}" onclick="updateCarStatus('${car.id}', 'inQueue')">
                                <i class="fa-solid fa-hourglass-half"></i> Sƒ±rada
                            </button>
                            <button class="status-btn exteriorwash ${car.status === 'exteriorWash' ? 'active' : ''}" onclick="updateCarStatus('${car.id}', 'exteriorWash')">
                                <i class="fa-solid fa-water"></i> Dƒ±≈ü Yƒ±kamada
                            </button>
                            <button class="status-btn dryingarea ${car.status === 'dryingArea' ? 'active' : ''}" onclick="updateCarStatus('${car.id}', 'dryingArea')">
                                <i class="fa-solid fa-wind"></i> Kurulama Alanƒ±nda
                            </button>
                            <button class="status-btn parkingarea ${car.status === 'parkingArea' ? 'active' : ''}" onclick="updateCarStatus('${car.id}', 'parkingArea')">
                                <i class="fa-solid fa-parking"></i> Park Alanƒ±nda
                            </button>
                            <button class="status-btn delivered ${car.status === 'delivered' ? 'active' : ''}" onclick="updateCarStatus('${car.id}', 'delivered')">
                                <i class="fa-solid fa-truck"></i> Teslim Edildi
                            </button>
                        </div>
                        <div class="button-group" style="justify-content: center; margin-top: 10px;">
                           ${showEditButton ? `<button class="btn btn-secondary" onclick="editCar('${car.id}')"><i class="fa-solid fa-edit"></i> D√ºzenle</button>` : ''}
                           ${showDeleteButton ? `<button class="btn btn-danger" onclick="deleteCar('${car.id}')"><i class="fa-solid fa-trash-alt"></i> Sil</button>` : ''}
                        </div>
                        ` : ''}
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', carCardHtml);
            });
        }

        /**
         * Kullanƒ±cƒ±nƒ±n girdiƒüi plaka numarasƒ±na g√∂re ara√ßlarƒ± filtreler.
         */
        window.searchCar = function() {
            const plateSearchInput = document.getElementById('plateSearch');
            const searchTerm = plateSearchInput.value.trim().toUpperCase();
            
            if (searchTerm.length < 2) {
                document.getElementById('carResults').innerHTML = '<p style="text-align: center; color: #777;">Plaka numarasƒ±nƒ± girerek ara√ß durumunu sorgulayabilirsiniz.</p>';
                return;
            }

            const filteredCars = window.cars.filter(car => 
                car.plate.toUpperCase().includes(searchTerm)
            );
            renderCars('carResults', filteredCars, false, false); 
        };

        /**
         * Memnuniyet anketi i√ßin se√ßilen puanƒ± ayarlar ve yƒ±ldƒ±zlarƒ±n g√∂rselini g√ºnceller.
         * @param {number} rating - Se√ßilen puan (1-5).
         */
        window.setRating = function(rating) {
            window.selectedRating = rating;
            const stars = document.querySelectorAll('#ratingStars .star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        };

        /**
         * M√º≈üteri geri bildirimini (puan ve yorum) Firestore'a g√∂nderir.
         */
        window.submitFeedback = async function() {
            if (!window.firestoreDb || !window.feedbackCollectionRef) {
                showNotification("Veritabanƒ± baƒülantƒ±sƒ± hen√ºz hazƒ±r deƒüil.", "error");
                return;
            }
            const feedbackText = document.getElementById('feedbackText').value.trim();
            
            if (window.selectedRating === 0 && !feedbackText) {
                showNotification('L√ºtfen bir puan verin veya yorum yazƒ±n!', 'error');
                return;
            }

            toggleButtonState('submitFeedbackBtn', true); // Butonu devre dƒ±≈üƒ± bƒ±rak
            try {
                await addDoc(window.feedbackCollectionRef, {
                    rating: window.selectedRating,
                    comment: feedbackText,
                    timestamp: new Date().toISOString(),
                    plate: document.getElementById('plateSearch').value.trim().toUpperCase() || 'N/A'
                });
                showNotification('Geri bildiriminiz ba≈üarƒ±yla g√∂nderildi!', 'success');
                
                // Anketi sƒ±fƒ±rla
                window.selectedRating = 0;
                document.getElementById('feedbackText').value = '';
                document.querySelectorAll('#ratingStars .star').forEach(star => star.classList.remove('active'));
                
            } catch (e) {
                console.error("Geri bildirim g√∂nderilirken hata olu≈ütu:", e);
                showNotification("Geri bildirim g√∂nderilirken hata olu≈ütu!", "error");
            } finally {
                toggleButtonState('submitFeedbackBtn', false); // Butonu tekrar etkinle≈ütir
            }
        };

        /**
         * Sisteme yeni bir kullanƒ±cƒ± ekler (Sadece Admin).
         */
        window.addUser = async function() {
            if (!window.currentUser || window.currentUser.role !== 'admin') {
                showNotification('Sadece adminler kullanƒ±cƒ± ekleyebilir!', 'error');
                return;
            }

            const newUsername = document.getElementById('newUsername');
            const newPassword = document.getElementById('newPassword');
            const newUserRole = document.getElementById('newUserRole');

            const fields = [
                { id: 'newUsername', name: 'Kullanƒ±cƒ± adƒ±', required: true },
                { id: 'newPassword', name: '≈ûifre', required: true, type: 'password' }
            ];
            if (!validateForm(fields)) {
                showNotification('L√ºtfen t√ºm zorunlu alanlarƒ± doldurun!', 'error');
                return;
            }

            if (window.users.some(u => u.username === newUsername.value.trim())) {
                showNotification('Bu kullanƒ±cƒ± adƒ± zaten mevcut!', 'error');
                newUsername.classList.add('is-invalid');
                document.getElementById('errorNewUsername').textContent = 'Bu kullanƒ±cƒ± adƒ± zaten mevcut.';
                return;
            }
            
            toggleButtonState('addUserBtn', true); // Butonu devre dƒ±≈üƒ± bƒ±rak
            try {
                window.users.push({ username: newUsername.value.trim(), password: newPassword.value.trim(), role: newUserRole.value });
                showNotification(`'${newUsername.value.trim()}' kullanƒ±cƒ±sƒ± (${newUserRole.value === 'admin' ? 'Admin' : '√áalƒ±≈üan'}) ba≈üarƒ±yla eklendi!`, 'success');
                
                newUsername.value = '';
                newPassword.value = '';
                newUserRole.value = 'user';
                renderUserList(); // Kullanƒ±cƒ± listesini g√ºncelle
                populateUserSelectionForPasswordReset(); // Kullanƒ±cƒ± se√ßme dropdown'ƒ±nƒ± g√ºncelle
            } catch (e) {
                console.error("Kullanƒ±cƒ± eklenirken hata olu≈ütu:", e);
                showNotification("Kullanƒ±cƒ± eklenirken hata olu≈ütu!", "error");
            } finally {
                toggleButtonState('addUserBtn', false); // Butonu tekrar etkinle≈ütir
            }
        };

        /**
         * Mevcut kullanƒ±cƒ±larƒ±n listesini render eder (Sadece Admin).
         */
        function renderUserList() {
            const userListContainer = document.getElementById('userList');
            if (!userListContainer) return;

            userListContainer.innerHTML = ''; // Mevcut listeyi temizle

            if (window.users.length === 0) {
                userListContainer.innerHTML = '<p style="text-align: center; color: #777;">Sistemde kayƒ±tlƒ± kullanƒ±cƒ± bulunmuyor.</p>';
                return;
            }

            const userCardsHtml = window.users.map(user => `
                <div class="car-card" style="margin-bottom: 15px; padding: 15px;">
                    <div class="car-header" style="margin-bottom: 5px;">
                        <span class="plate-number" style="font-size: 20px;">${user.username}</span>
                        <span class="status ${user.role === 'admin' ? 'ready' : 'delivered'}" style="font-size: 11px;">
                            ${user.role === 'admin' ? 'Admin' : '√áalƒ±≈üan'}
                        </span>
                    </div>
                    <div class="detail-item" style="padding: 8px;">
                        <div class="detail-label">≈ûifre</div>
                        <div class="detail-value">${user.password}</div>
                    </div>
                </div>
            `).join('');
            userListContainer.innerHTML = userCardsHtml;
        }

        /**
         * ≈ûifre deƒüi≈ütirmek i√ßin kullanƒ±cƒ± se√ßimi dropdown'ƒ±nƒ± doldurur.
         */
        function populateUserSelectionForPasswordReset() {
            const selectElement = document.getElementById('selectUserForPasswordReset');
            if (!selectElement) return;

            selectElement.innerHTML = '<option value="">Kullanƒ±cƒ± Se√ßin</option>'; // Varsayƒ±lan se√ßeneƒüi ekle ve temizle

            window.users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.username;
                option.textContent = `${user.username} (${user.role === 'admin' ? 'Admin' : '√áalƒ±≈üan'})`;
                selectElement.appendChild(option);
            });
        }

        /**
         * Giri≈ü yapmƒ±≈ü kullanƒ±cƒ±nƒ±n kendi ≈üifresini deƒüi≈ütirir.
         */
        window.changeMyOwnPassword = async function() {
            if (!window.currentUser) {
                showNotification('≈ûifre deƒüi≈ütirmek i√ßin giri≈ü yapmalƒ±sƒ±nƒ±z!', 'error');
                return;
            }

            const oldPasswordInput = document.getElementById('oldPassword');
            const newAuthPasswordInput = document.getElementById('newAuthPassword');
            const confirmNewAuthPasswordInput = document.getElementById('confirmNewAuthPassword');

            const fields = [
                { id: 'oldPassword', name: 'Eski ≈ûifre', required: true },
                { id: 'newAuthPassword', name: 'Yeni ≈ûifre', required: true, type: 'password' },
                { id: 'confirmNewAuthPassword', name: 'Yeni ≈ûifre Tekrar', required: true, type: 'confirmPassword', matchId: 'newAuthPassword' }
            ];

            if (!validateForm(fields)) {
                showNotification('L√ºtfen t√ºm ≈üifre alanlarƒ±nƒ± doƒüru doldurun!', 'error');
                return;
            }

            if (oldPasswordInput.value !== window.currentUser.password) {
                showNotification('Eski ≈üifreniz yanlƒ±≈ü!', 'error');
                oldPasswordInput.classList.add('is-invalid');
                document.getElementById('errorOldPassword').textContent = 'Eski ≈üifre yanlƒ±≈ü.';
                return;
            }

            if (newAuthPasswordInput.value === oldPasswordInput.value) {
                showNotification('Yeni ≈üifre eski ≈üifre ile aynƒ± olamaz!', 'error');
                newAuthPasswordInput.classList.add('is-invalid');
                document.getElementById('errorNewAuthPassword').textContent = 'Yeni ≈üifre eski ≈üifre ile aynƒ± olamaz.';
                return;
            }

            toggleButtonState('changeMyOwnPasswordBtn', true);
            showNotification('≈ûifre g√ºncelleniyor...', 'info');
            try {
                // Demo i√ßin yerel kullanƒ±cƒ± dizisini g√ºncelle
                const userIndex = window.users.findIndex(u => u.username === window.currentUser.username);
                if (userIndex !== -1) {
                    window.users[userIndex].password = newAuthPasswordInput.value;
                    window.currentUser.password = newAuthPasswordInput.value; // G√ºncel oturumu da g√ºncelle
                    localStorage.setItem('currentUser', JSON.stringify(window.currentUser)); // Local storage'ƒ± g√ºncelle
                    showNotification('≈ûifreniz ba≈üarƒ±yla deƒüi≈ütirildi!', 'success');
                    
                    oldPasswordInput.value = '';
                    newAuthPasswordInput.value = '';
                    confirmNewAuthPasswordInput.value = '';
                    renderUserList(); // Kullanƒ±cƒ± listesini g√ºncelle
                    populateUserSelectionForPasswordReset(); // Dropdown'ƒ± g√ºncelle
                } else {
                    showNotification('Kullanƒ±cƒ± bulunamadƒ±!', 'error');
                }
            } catch (e) {
                console.error("≈ûifre deƒüi≈ütirilirken hata olu≈ütu:", e);
                showNotification("≈ûifre deƒüi≈ütirilirken hata olu≈ütu!", "error");
            } finally {
                toggleButtonState('changeMyOwnPasswordBtn', false);
            }
        };

        /**
         * Se√ßilen kullanƒ±cƒ±nƒ±n ≈üifresini admin olarak sƒ±fƒ±rlar/deƒüi≈ütirir.
         */
        window.resetSelectedUserPassword = async function() {
            if (!window.currentUser || window.currentUser.role !== 'admin') {
                showNotification('Bu i≈ülemi yapmaya yetkiniz yok!', 'error');
                return;
            }

            const selectUserForPasswordReset = document.getElementById('selectUserForPasswordReset');
            const selectedUserNewPassword = document.getElementById('selectedUserNewPassword');
            const confirmSelectedUserNewPassword = document.getElementById('confirmSelectedUserNewPassword');

            const fields = [
                { id: 'selectUserForPasswordReset', name: 'Kullanƒ±cƒ±', required: true },
                { id: 'selectedUserNewPassword', name: 'Yeni ≈ûifre', required: true, type: 'password' },
                { id: 'confirmSelectedUserNewPassword', name: 'Yeni ≈ûifre Tekrar', required: true, type: 'confirmPassword', matchId: 'selectedUserNewPassword' }
            ];

            if (!validateForm(fields)) {
                showNotification('L√ºtfen t√ºm alanlarƒ± doƒüru doldurun!', 'error');
                return;
            }

            const targetUsername = selectUserForPasswordReset.value;
            const newPassword = selectedUserNewPassword.value;

            const targetUser = window.users.find(u => u.username === targetUsername);

            if (!targetUser) {
                showNotification('Se√ßilen kullanƒ±cƒ± bulunamadƒ±!', 'error');
                return;
            }
            if (targetUser.password === newPassword) {
                showNotification('Yeni ≈üifre eski ≈üifre ile aynƒ± olamaz!', 'error');
                selectedUserNewPassword.classList.add('is-invalid');
                document.getElementById('errorSelectedUserNewPassword').textContent = 'Yeni ≈üifre eski ≈üifre ile aynƒ± olamaz.';
                return;
            }

            toggleButtonState('resetSelectedUserPasswordBtn', true);
            showNotification(`'${targetUsername}' kullanƒ±cƒ±sƒ±nƒ±n ≈üifresi g√ºncelleniyor...`, 'info');
            try {
                const userIndex = window.users.findIndex(u => u.username === targetUsername);
                if (userIndex !== -1) {
                    window.users[userIndex].password = newPassword;
                    showNotification(`'${targetUsername}' kullanƒ±cƒ±sƒ±nƒ±n ≈üifresi ba≈üarƒ±yla sƒ±fƒ±rlandƒ±!`, 'success');
                    
                    selectUserForPasswordReset.value = '';
                    selectedUserNewPassword.value = '';
                    confirmSelectedUserNewPassword.value = '';
                    renderUserList(); // Kullanƒ±cƒ± listesini g√ºncelle
                    // Eƒüer ≈üifresi deƒüi≈üen kullanƒ±cƒ± o an giri≈ü yapmƒ±≈ü kullanƒ±cƒ± ise, kendi localStorage'ƒ±nƒ± da g√ºnellemeli
                    if (window.currentUser && window.currentUser.username === targetUsername) {
                        window.currentUser.password = newPassword;
                        localStorage.setItem('currentUser', JSON.stringify(window.currentUser));
                    }
                } else {
                    showNotification('Kullanƒ±cƒ± bulunamadƒ±!', 'error');
                }
            } catch (e) {
                console.error("≈ûifre sƒ±fƒ±rlanƒ±rken hata olu≈ütu:", e);
                showNotification("≈ûifre sƒ±fƒ±rlanƒ±rken hata olu≈ütu!", "error");
            } finally {
                toggleButtonState('resetSelectedUserPasswordBtn', false);
            }
        };

        /**
         * Ara√ß ekleme veya d√ºzenleme i≈ülemini y√∂netir.
         * Formdaki `currentEditingCarId` deƒüerine g√∂re ekleme veya g√ºncelleme yapar.
         */
        window.handleAddOrUpdateCar = async function() {
            if (!window.firestoreDb || !window.carsCollectionRef) {
                showNotification("Veritabanƒ± baƒülantƒ±sƒ± hen√ºz hazƒ±r deƒüil.", "error");
                return;
            }
            if (!window.currentUser || (window.currentUser.role !== 'user' && window.currentUser.role !== 'admin')) {
                showNotification('Bu i≈ülemi yapmaya yetkiniz yok!', 'error');
                return;
            }

            const currentEditingCarId = document.getElementById('currentEditingCarId').value;

            const newPlateInput = document.getElementById('newPlate');
            const customerNameInput = document.getElementById('customerName');
            const customerPhoneInput = document.getElementById('customerPhone');
            const carModelInput = document.getElementById('carModel');
            const serviceTypeInput = document.getElementById('serviceType');
            const carStatusInput = document.getElementById('carStatus');
            const estimatedTimeInput = document.getElementById('estimatedTime');
            const carPriceInput = document.getElementById('carPrice');

            const fields = [
                { id: 'newPlate', name: 'Plaka', required: true },
                { id: 'serviceType', name: 'Hizmet T√ºr√º', required: true },
                { id: 'carStatus', name: 'Durum', required: true },
                { id: 'customerName', name: 'M√º≈üteri Adƒ±', required: false },
                { id: 'customerPhone', name: 'Telefon', required: false, type: 'phone' },
                { id: 'carModel', name: 'Ara√ß Modeli', required: false },
                { id: 'estimatedTime', name: 'Tahmini S√ºre', required: false, type: 'number', min: 1 },
                { id: 'carPrice', name: 'Fiyat', required: false, type: 'number', min: 0 }
            ];

            if (!validateForm(fields)) {
                showNotification('L√ºtfen t√ºm zorunlu alanlarƒ± doldurun ve diƒüerlerini doƒüru formatta girin!', 'error');
                return;
            }

            const carData = {
                plate: newPlateInput.value.trim().toUpperCase(),
                customer: customerNameInput.value.trim() || null, // Bo≈üsa null kaydet
                phone: customerPhoneInput.value.trim() || null, // Bo≈üsa null kaydet
                model: carModelInput.value.trim() || null, // Bo≈üsa null kaydet
                serviceType: serviceTypeInput.value,
                status: carStatusInput.value,
                addedBy: window.currentUser ? window.currentUser.username : 'Unknown',
                estimatedTime: estimatedTimeInput.value ? parseInt(estimatedTimeInput.value) : null,
                currentProgress: (carStatusInput.value === 'delivered' || carStatusInput.value === 'parkingArea') ? 100 : 0, // ƒ∞lerleme durumunu g√ºncelle
                price: carPriceInput.value ? parseFloat(carPriceInput.value) : null
            };

            toggleButtonState('submitCarBtn', true); // Butonu devre dƒ±≈üƒ± bƒ±rak
            toggleButtonState('cancelCarEditBtn', true);
            showNotification('ƒ∞≈ülem yapƒ±lƒ±yor...', 'info');
            try {
                if (currentEditingCarId) {
                    // D√ºzenleme i≈ülemi
                    const carRef = doc(window.firestoreDb, window.carsCollectionRef.path, currentEditingCarId);
                    await updateDoc(carRef, carData);
                    showNotification(`'${carData.plate}' plakalƒ± ara√ß ba≈üarƒ±yla g√ºncellendi!`, 'success');
                } else {
                    // Ekleme i≈ülemi
                    // Plakanƒ±n zaten var olup olmadƒ±ƒüƒ±nƒ± Firestore'da kontrol et
                    const q = query(window.carsCollectionRef, where("plate", "==", carData.plate));
                    const querySnapshot = await getDocs(q);
                    if (!querySnapshot.empty) {
                        showNotification('Bu plaka numarasƒ± zaten kayƒ±tlƒ±!', 'error');
                        newPlateInput.classList.add('is-invalid');
                        document.getElementById('errorNewPlate').textContent = 'Bu plaka numarasƒ± zaten kayƒ±tlƒ±.';
                        return; // ƒ∞≈ülemi durdur
                    }
                    carData.entryTime = new Date().toISOString(); // Yeni ara√ß i√ßin giri≈ü zamanƒ±
                    await addDoc(window.carsCollectionRef, carData);
                    showNotification(`'${carData.plate}' plakalƒ± ara√ß ba≈üarƒ±yla eklendi!`, 'success');
                }
                cancelCarEdit(); // Formu temizle ve ekleme moduna d√∂n
            } catch (e) {
                console.error("Ara√ß i≈ülemi sƒ±rasƒ±nda hata olu≈ütu:", e);
                showNotification("Ara√ß i≈ülemi sƒ±rasƒ±nda hata olu≈ütu!", "error");
            } finally {
                toggleButtonState('submitCarBtn', false); // Butonu tekrar etkinle≈ütir
                toggleButtonState('cancelCarEditBtn', false);
            }
        };

        /**
         * Bir aracƒ± d√ºzenlemek i√ßin formu doldurur.
         * @param {string} carId - D√ºzenlenecek aracƒ±n Firestore Belge ID'si.
         */
        window.editCar = function(carId) {
            const car = window.cars.find(c => c.id === carId);
            if (!car) {
                showNotification('D√ºzenlenecek ara√ß bulunamadƒ±!', 'error');
                return;
            }

            document.getElementById('currentEditingCarId').value = car.id;
            document.getElementById('carFormTitle').innerHTML = '<i class="fa-solid fa-edit"></i> Ara√ß D√ºzenle';
            document.getElementById('submitCarBtn').innerHTML = '<i class="fa-solid fa-save"></i> Aracƒ± G√ºncelle';
            document.getElementById('cancelCarEditBtn').style.display = 'inline-flex'; // Butonu g√∂ster

            document.getElementById('newPlate').value = car.plate;
            document.getElementById('customerName').value = car.customer || '';
            document.getElementById('customerPhone').value = car.phone || '';
            document.getElementById('carModel').value = car.model || '';
            document.getElementById('serviceType').value = car.serviceType;
            document.getElementById('carStatus').value = car.status;
            document.getElementById('estimatedTime').value = car.estimatedTime || '';
            document.getElementById('carPrice').value = car.price || '';

            // Form validasyon hatalarƒ±nƒ± temizle
            document.querySelectorAll('#employeeScreen .error-message').forEach(el => el.textContent = '');
            document.querySelectorAll('#employeeScreen input, #employeeScreen select').forEach(el => el.classList.remove('is-invalid'));

            // Sayfanƒ±n en √ºst√ºne kaydƒ±r
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        /**
         * Ara√ß ekleme/d√ºzenleme formunu temizler ve ekleme moduna d√∂ner.
         */
        window.cancelCarEdit = function() {
            document.getElementById('currentEditingCarId').value = '';
            document.getElementById('carFormTitle').innerHTML = '<i class="fa-solid fa-car-plus"></i> Yeni Ara√ß Ekle';
            document.getElementById('submitCarBtn').innerHTML = '<i class="fa-solid fa-car-rear"></i> Ara√ß Ekle';
            document.getElementById('cancelCarEditBtn').style.display = 'none';

            document.getElementById('newPlate').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('carModel').value = '';
            document.getElementById('serviceType').value = 'Dƒ±≈ü Yƒ±kama';
            document.getElementById('carStatus').value = 'inQueue'; // Varsayƒ±lan ba≈ülangƒ±√ß durumu
            document.getElementById('estimatedTime').value = '';
            document.getElementById('carPrice').value = '';

            // Form validasyon hatalarƒ±nƒ± temizle
            document.querySelectorAll('#employeeScreen .error-message').forEach(el => el.textContent = '');
            document.querySelectorAll('#employeeScreen input, #employeeScreen select').forEach(el => el.classList.remove('is-invalid'));
        };

        /**
         * Belirli bir aracƒ±n durumunu g√ºnceller.
         * @param {string} carId - G√ºncellenecek aracƒ±n Firestore Belge ID'si.
         * @param {string} newStatus - Yeni durum (inQueue, exteriorWash, dryingArea, parkingArea, delivered).
         */
        window.updateCarStatus = async function(carId, newStatus) {
            if (!window.firestoreDb || !window.carsCollectionRef) {
                showNotification("Veritabanƒ± baƒülantƒ±sƒ± hen√ºz hazƒ±r deƒüil.", "error");
                return;
            }
            if (!window.currentUser || (window.currentUser.role !== 'user' && window.currentUser.role !== 'admin')) {
                showNotification('Durum g√ºncelleme yetkiniz yok!', 'error');
                return;
            }

            const carRef = doc(window.firestoreDb, window.carsCollectionRef.path, carId);
            const carData = window.cars.find(car => car.id === carId); 

            if (!carData) {
                showNotification('G√ºncellenecek ara√ß bulunamadƒ±!', 'error');
                return;
            }

            // Butonlarƒ± ve ilgili UI'larƒ± devre dƒ±≈üƒ± bƒ±rak
            document.querySelectorAll(`.status-btn[onclick*="updateCarStatus('${carId}'"]`).forEach(btn => btn.disabled = true);
            showNotification('Durum g√ºncelleniyor...', 'info');

            try {
                await updateDoc(carRef, {
                    status: newStatus,
                    // Duruma g√∂re ilerleme ayarƒ± (√∂rn: Teslim edildi %100, diƒüerleri 0)
                    currentProgress: (newStatus === 'delivered' || newStatus === 'parkingArea') ? 100 : 0, 
                });
                // T√ºrk√ße kar≈üƒ±lƒ±ƒüƒ±nƒ± almak i√ßin statusMap kullan
                const statusMapTurkish = {
                    'inQueue': 'Sƒ±rada',
                    'exteriorWash': 'Dƒ±≈ü Yƒ±kamada',
                    'dryingArea': 'Kurulama Alanƒ±nda',
                    'parkingArea': 'Park Alanƒ±nda',
                    'delivered': 'Teslim Edildi'
                };
                const displayStatus = statusMapTurkish[newStatus] || capitalizeFirstLetter(newStatus);

                showNotification(`'${carData.plate}' plakalƒ± aracƒ±n durumu '${displayStatus}' olarak g√ºncellendi!`, 'success');
                // Firestore listener otomatik olarak UI'yƒ± g√ºncelleyecektir.
            } catch (e) {
                console.error("Ara√ß durumu g√ºncellenirken hata olu≈ütu:", e);
                showNotification("Ara√ß durumu g√ºncellenirken hata olu≈ütu!", "error");
            } finally {
                // T√ºm ilgili butonlarƒ± tekrar etkinle≈ütir
                document.querySelectorAll(`.status-btn[onclick*="updateCarStatus('${carId}'"]`).forEach(btn => btn.disabled = false);
            }
        };

        /**
         * Sistemi bir aracƒ± siler (Sadece Admin).
         * @param {string} carId - Silinecek aracƒ±n Firestore Belge ID'si.
         */
        window.deleteCar = async function(carId) {
            if (!window.firestoreDb || !window.carsCollectionRef) {
                showNotification("Veritabanƒ± baƒülantƒ±sƒ± hen√ºz hazƒ±r deƒüil.", "error");
                return;
            }
            if (!window.currentUser || window.currentUser.role !== 'admin') {
                showNotification('Sadece adminler ara√ß silebilir!', 'error');
                return;
            }

            // NOT: window.confirm yerine √∂zel bir modal kullanƒ±lmasƒ± tavsiye edilir.
            const userConfirmed = confirm('Bu aracƒ± silmek istediƒüinizden emin misiniz?'); 
            if (!userConfirmed) return;

            // Genel bir silme butonu olduƒüu varsayƒ±lƒ±rsa toggle yapƒ±sƒ± biraz farklƒ± olmalƒ±.
            // √ñrneƒüin, tƒ±klanan karttaki butonu devre dƒ±≈üƒ± bƒ±rakmak i√ßin daha spesifik bir selector gerekir.
            showNotification('Ara√ß siliniyor...', 'info');

            try {
                const carRef = doc(window.firestoreDb, window.carsCollectionRef.path, carId);
                await deleteDoc(carRef);
                showNotification('Ara√ß ba≈üarƒ±yla silindi!', 'success');
                // Firestore listener otomatik olarak UI'yƒ± g√ºncelleyecektir.
            } catch (e) {
                console.error("Ara√ß silinirken hata olu≈ütu:", e);
                showNotification("Ara√ß silinirken hata olu≈ütu!", "error");
            }
        };

        /**
         * √áalƒ±≈üan paneli i√ßin ara√ß listesini render eder (aksiyon butonlarƒ± ile).
         */
        function renderEmployeeCarList() {
            renderCars('employeeCarList', window.cars, true, true); // Aksiyon butonlarƒ± var, √ßekmece var
        }

        /**
         * G√ºnl√ºk raporlarƒ± olu≈üturur ve g√∂r√ºnt√ºler.
         */
        async function renderReports() {
            if (!window.firestoreDb) {
                showNotification("Veritabanƒ± baƒülantƒ±sƒ± hen√ºz hazƒ±r deƒüil.", "error");
                return;
            }
            const todayIstanbul = new Date().toLocaleDateString('en-CA', { timeZone: 'Europe/Istanbul' }); 

            // Firestore'dan g√ºncel ara√ßlarƒ± filtrele (entryTime'a g√∂re)
            const carsToday = window.cars.filter(car => 
                new Date(car.entryTime).toLocaleDateString('en-CA', { timeZone: 'Europe/Istanbul' }) === todayIstanbul
            );

            document.getElementById('totalCars').textContent = carsToday.length;
            
            // Yeni durumlarƒ± raporlara yansƒ±t
            document.getElementById('washingCars').textContent = carsToday.filter(car => car.status === 'exteriorWash').length;
            document.getElementById('readyCars').textContent = carsToday.filter(car => car.status === 'dryingArea').length;
            document.getElementById('deliveredCars').textContent = carsToday.filter(car => car.status === 'delivered').length;
            // Diƒüer durumlarƒ± da g√∂stermek isterseniz buraya ekleyebilirsiniz (√∂rn: Sƒ±rada, Park Alanƒ±nda)


            // Firestore'dan geri bildirimleri filtrele
            const feedbackToday = window.feedback.filter(f => 
                new Date(f.timestamp).toLocaleDateString('en-CA', { timeZone: 'Europe/Istanbul' }) === todayIstanbul
            );
            const totalRating = feedbackToday.reduce((sum, f) => sum + f.rating, 0);
            const avgRating = feedbackToday.length > 0 ? (totalRating / feedbackToday.length).toFixed(1) : '0.0';
            document.getElementById('avgRating').textContent = avgRating;

            const totalRevenue = carsToday
                .filter(car => car.status === 'delivered' && car.price)
                .reduce((sum, car) => sum + car.price, 0);
            document.getElementById('totalRevenue').textContent = `‚Ç∫${totalRevenue.toLocaleString('tr-TR')}`;

            renderCars('detailedCarList', carsToday, false, true); // Aksiyon butonlarƒ± yok, √ßekmece var
        }

        /**
         * Basit bir benzersiz ID olu≈üturur (Firestore kendi ID'lerini kullanacak olsa da bu demo i√ßin duruyor).
         */
        function generateUniqueId() {
             return Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
        }

        /**
         * ISO string tarihini 'GG.AA.YYYY' formatƒ±na d√∂n√º≈üt√ºr√ºr.
         * @param {string} isoString - ISO tarih string'i.
         * @returns {string} Formatlanmƒ±≈ü tarih.
         */
        function formatDate(isoString) {
            const date = new Date(isoString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0'); // Ay 0-indekslidir
            const year = date.getFullYear();
            return `${day}.${month}.${year}`;
        }

        /**
         * ISO string tarihini 'SS:DD' formatƒ±na d√∂n√º≈üt√ºr√ºr.
         * @param {string} isoString - ISO tarih string'i.
         * @returns {string} Formatlanmƒ±≈ü saat.
         */
        function formatTime(isoString) {
            const date = new Date(isoString);
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        /**
         * Bir string'in ilk harfini b√ºy√ºk yapar.
         * @param {string} string - Giri≈ü string'i.
         * @returns {string} ƒ∞lk harfi b√ºy√ºk olan string.
         */
        function capitalizeFirstLetter(string) {
            if (!string) return '';
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        /**
         * G√ºnl√ºk veri temizliƒüini ve ar≈üivlemesini yapar.
         * Her yeni g√ºn (TR saati) ba≈üladƒ±ƒüƒ±nda Firestore'daki eski verileri ar≈üivler ve ana koleksiyonlarƒ± temizler.
         */
        async function performDailyCleanup() {
            if (!window.firestoreDb || !window.settingsDocRef || !window.carsCollectionRef || !window.feedbackCollectionRef || !window.historicalCarsCollectionRef || !window.historicalFeedbackCollectionRef) {
                console.warn("Firestore veya ilgili koleksiyon referanslarƒ± hazƒ±r deƒüil, temizlik yapƒ±lamaz.");
                return;
            }

            const todayIstanbul = new Date().toLocaleDateString('en-CA', { timeZone: 'Europe/Istanbul' }); 

            try {
                // Son temizleme tarihini Firestore'dan oku
                const settingsDoc = await getDoc(window.settingsDocRef);
                const lastCleanupDate = settingsDoc.exists() ? settingsDoc.data().lastCleanupDate : null;

                console.log(`G√ºncel ƒ∞stanbul Tarihi: ${todayIstanbul}`);
                console.log(`Son Temizleme Tarihi (Firestore'dan): ${lastCleanupDate}`);

                if (!lastCleanupDate || todayIstanbul > lastCleanupDate) {
                    showNotification('G√ºnl√ºk temizlik ba≈ülatƒ±lƒ±yor...', 'info');
                    console.log("Yeni g√ºn tespit edildi, g√ºnl√ºk temizlik ve ar≈üivleme ba≈ülatƒ±lƒ±yor.");

                    // Sadece bug√ºnden eski olan ara√ßlarƒ± al
                    const oldCarsQuery = query(window.carsCollectionRef, where("entryTime", "<", new Date(todayIstanbul).toISOString()));
                    const carsSnapshot = await getDocs(oldCarsQuery);
                    
                    if (!carsSnapshot.empty) {
                        const carMovePromises = carsSnapshot.docs.map(async (d) => {
                            const carData = d.data();
                            await addDoc(window.historicalCarsCollectionRef, { ...carData, originalId: d.id, archivedAt: new Date().toISOString() }); // Ar≈üive ta≈üƒ±
                            await deleteDoc(doc(window.firestoreDb, window.carsCollectionRef.path, d.id)); // Orijinalini sil
                        });
                        await Promise.all(carMovePromises);
                        console.log(`${carsSnapshot.size} eski ara√ß kaydƒ± ar≈üivlendi ve silindi.`);
                    } else {
                        console.log("Ar≈üivlenecek eski ara√ß kaydƒ± bulunamadƒ±.");
                    }

                    // Sadece bug√ºnden eski olan geri bildirimleri al
                    const oldFeedbackQuery = query(window.feedbackCollectionRef, where("timestamp", "<", new Date(todayIstanbul).toISOString()));
                    const feedbackSnapshot = await getDocs(oldFeedbackQuery);

                    if (!feedbackSnapshot.empty) {
                        const feedbackMovePromises = feedbackSnapshot.docs.map(async (d) => {
                            const feedbackData = d.data();
                            await addDoc(window.historicalFeedbackCollectionRef, { ...feedbackData, originalId: d.id, archivedAt: new Date().toISOString() }); // Ar≈üive ta≈üƒ±
                            await deleteDoc(doc(window.firestoreDb, window.feedbackCollectionRef.path, d.id)); // Orijinalini sil
                        });
                        await Promise.all(feedbackMovePromises);
                        console.log(`${feedbackSnapshot.size} eski geri bildirim kaydƒ± ar≈üivlendi ve silindi.`);
                    } else {
                        console.log("Ar≈üivlenecek eski geri bildirim kaydƒ± bulunamadƒ±.");
                    }
                    
                    // Son temizleme tarihini Firestore'a kaydet
                    await setDoc(window.settingsDocRef, { lastCleanupDate: todayIstanbul });

                    showNotification('G√ºnl√ºk ara√ß kayƒ±tlarƒ± ve geri bildirimler temizlendi ve ar≈üivlendi!', 'success');
                    console.log("G√ºnl√ºk temizlik Firestore √ºzerinde tamamlandƒ±.");
                } else {
                    console.log("Bug√ºn temizlik gerekmiyor.");
                }
            } catch (e) {
                console.error("G√ºnl√ºk temizlik sƒ±rasƒ±nda hata olu≈ütu:", e);
                showNotification("G√ºnl√ºk temizlik sƒ±rasƒ±nda hata olu≈ütu!", "error");
            }
        }

        // Uygulama y√ºklendiƒüinde ba≈ülatma noktasƒ±
        window.onload = function() {
            console.log("Window y√ºklendi. Firebase ba≈ülatƒ±lƒ±yor...");
            initializeFirebaseAndAuth(); // Firebase'i ba≈ülat ve kimlik doƒürulamayƒ± y√∂net
        };
    </script>
</body>
</html>
